<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Приглашение в семью</title>
    <meta property="og:title" content="Приглашение в Baby Tracker" />
    <meta property="og:description" content="Нажмите, чтобы присоединиться к совместному ведению дневника." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; text-align: center; padding: 40px; background-color: #F5EFE6; color: #1C1B1F; }
        .button { 
            display: inline-block; 
            padding: 15px 30px; 
            background-color: #E4B6A6; 
            color: white; 
            text-decoration: none; 
            border-radius: 25px; 
            font-weight: bold;
            margin-top: 20px;
        }
        h1 { font-size: 24px; }
        p { font-size: 16px; color: #605D62; }
    </style>
    <script type="text/javascript">
        function redirect() {
            // 1. Получаем payload (p) из параметров URL
            const params = new URLSearchParams(window.location.search);
            const payload = params.get('p');

            if (!payload) {
                document.getElementById('status').innerText = 'Ошибка: Ссылка не содержит данных приглашения.';
                return;
            }

            // 2. Собираем Deep Link для приложения
            // Важно: payload уже URL-кодирован в исходной ссылке, но браузер его декодирует при чтении.
            // Нам нужно передать его в приложение. Приложение ожидает encoded строку? 
            // Android Uri.getQueryParameter() декодирует автоматически.
            // Так что просто передаем как есть.
            const deepLink = "babytracker://invite?p=" + encodeURIComponent(payload);
            
            document.getElementById('status').innerText = 'Открываем приложение...';

            // 3. Пытаемся открыть приложение
            window.location.href = deepLink;

            // 4. Запасной план: если не открылось через 2 сек -> Google Play
            setTimeout(function () {
                const playStoreUrl = "https://play.google.com/store/apps/details?id=com.babytracker"; // Замените на RuStore если нужно
                document.getElementById('status').innerText = 'Приложение не открылось?';
                document.getElementById('hint').style.display = 'block';
            }, 2000);
        }
        
        window.onload = redirect;
    </script>
</head>
<body>
    <h1 id="status">Загрузка...</h1>
    <p id="hint" style="display:none;">Убедитесь, что приложение установлено, и попробуйте нажать кнопку ниже.</p>
    
    <!-- Кнопка ручного запуска, если JS не сработал -->
    <a id="manualLink" href="#" onclick="redirect(); return false;" class="button">Открыть приложение</a>
</body>
</html>
